{# templates/add_publication/index.html.twig #}

{% extends 'base.html.twig' %}

{% block title %}Add Publication{% endblock %}

{% block body %}
 <style>
        .publication {
            display: flex;
            border: 1px solid #ddd;
            padding: 20px;
        }

        .ajoutPublication {
            margin-right: 20px;
            border: 1px solid #ddd;
            padding: 15px;
            box-shadow: 1px 1px 3px #888888; /* 3D effect */
        }

        .listPublication {
            width: 70%;
            border: 1px solid #ddd;
            padding: 15px;
            box-shadow: 1px 1px 3px #888888; /* 3D effect */
        }

        /* Style for the form */
        form {
            margin-bottom: 20px;
        }

        /* Style for the filter dropdown */
        #projectFilter {
            width: 200px;
            margin-bottom: 10px;
        }

        /* Style for the publication list table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
  
<div class="publication">
        <div class="ajoutPublication">

    <h1>Add Publication</h1>

    {# Publication form #}
    {{ form_start(form) }}
    {{ form_widget(form) }}
    <button type="submit" class="btn btn-primary">Add Publication</button>
    {{ form_end(form) }}
    </div>
    <div class="listPublication">

    {# Table of publications #}
        <form method="get" action="{{ path('add_publication') }}">
        <div class="mb-3">
            <label for="projectFilter" class="form-label">Filter by Project:</label>
            <select name="projectFilter" id="projectFilter" class="form-select" onchange="this.form.submit()">
                <option value="" {% if not app.request.query.get('projectFilter') %}selected{% endif %}>All Projects</option>
                {% for project in project_choices %}
                    <option value="{{ project.getId() }}" {% if app.request.query.get('projectFilter') == project.getId() %}selected{% endif %}>
                        {{ project.getName() }}
                    </option>
                {% endfor %}
            </select>
        </div>
    </form>
        <table class="table">
            {# Table headers... #}

          <tbody>
    {% for publication in publications %}
        {# Check if the project filter matches or is not set #}
        {% if not app.request.query.get('projectFilter') or app.request.query.get('projectFilter') == publication.getProjet().getId() %}
            <tr>
                <th scope="row">{{ loop.index }}</th>
                <td>{{ publication.getTitle() }}</td>
                <td>{{ publication.getProjet().getName() }}</td>
<td>
    {% if publication.getChercheur() is not null %}
        {{ publication.getChercheur().getEmail() }}
    {% else %}
        <!-- Handle the case where Chercheur is null -->
        Not Available
    {% endif %}
</td>
                <td>{{ publication.getDateP()|date('Y-m-d') }}</td>
                <td>
                   <a href="{{ path('delete_publication', {'id': publication.getId()}) }}"
   class="btn btn-danger btn-sm"
   title="Delete"
   onclick="return confirm('Are you sure you want to delete this publication?')">
    <i class="fas fa-trash-alt"></i>
</a>
                </td>
            </tr>
        {% endif %}
    {% endfor %}
</tbody>
        </table>
    </div>
    </div>
{% endblock %}
